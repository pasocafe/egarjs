<!DOCTYPE html><html><head><meta charset="utf-8"/>
<!--<meta name="apple-mobile-web-app-capable" content="yes"/> not supported getUserMedia on PWA -->
<title>delaymirror</title>
<script src="https://taisukef.github.io/egarjs/egarjs.js"></script>
<script>"use strict"
window.USE_CAMERA_FRONT = true
var main = function(app) {
	var delaysec = 1.5
	var buflen = delaysec * 60
	var idxbuf = 0
	var buf = null

	var createCanvas = function(w, h) {
		var canvas = document.createElement('canvas')
		canvas.width = w
		canvas.height = h
		canvas.g = canvas.getContext('2d')
		return canvas
	}
	var freez = false
	app.getBackgroundImage = function(video) {
		const vw = video.videoWidth;
		const vh = video.videoHeight;

		if (vw == 0 || vh == 0) {
			return video
		}
		if (buf == null) {
			buf = []
			for (var i = 0; i < buflen; i++)
				buf[i] = createCanvas(vw, vh)
		}
		if (!freez) {
			buf[idxbuf].g.drawImage(video, 0, 0, vw, vh)
			idxbuf = (idxbuf + 1) % buflen
		}
		var imgsrc = buf[idxbuf]
		if (imgsrc.width != vw || imgsrc.height != vh) {
			buf = null
			return video
		}
		return imgsrc
	}
	app.loop = function(g, ts, dt, scrw) {
	}
	app.tap = function() {
		freez = !freez
	}
}
</script>
</head>
<body><video id="video" playsinline></video></body>
</html>
